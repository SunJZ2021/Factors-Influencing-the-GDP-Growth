---
title: "\\huge\\bf{The Convergence in per Capita Income}\\vspace{2em}"
author: |
  | 200357876
  | *SoMaS, University of Sheffield*
date: "November 2022\\vspace{10em}"
abstract:
  - "This is the first paragraph of the abstract. \\thispagestyle{empty} \\newpage \\pagenumbering{arabic}"
bibliography: refdatabase.bib 
output:
  bookdown::pdf_document2:
    highlight:  breezedark
    fig_width: 7
    fig_height: 6
    fig_caption: TRUE
    df_print: kable
    latex_engine: pdflatex
    citation_package: natbib
    number_sections: TRUE
    toc: TRUE
    toc_depth: 2
header-includes:
  - \usepackage{float}
fontsize: 12pt
papersize: A4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(gtsummary)
library(ggplot2)
library(gridExtra)
library(kableExtra)
library(cowplot)
library(ggfortify)
library(showtext)
font_add_google("Oswald", "oswald")
font_add_google("Roboto", "Roboto")
font_add_google("Gochi Hand", "gochi")
font_add_google("Montserrat Alternates", "montse")
trace(grDevices::png, exit = quote({
  showtext::showtext_begin()
}), print = FALSE)
showtext_auto()

knitr::opts_chunk$set(echo = FALSE, tidy=TRUE,fig.align='center',
                 external=TRUE,
                 echo=FALSE,
                 warning=FALSE,
                 fig.pos='H',
                 tab.pos='H')
UNGrowth <- read_csv("UNGrowth.csv")
```
\newpage
\section{Introduction}
\section{Data preprocessing}
\begin{itemize}
\item {\tt region} Region of the world: Africa, Asia, Caribbean, Europe, America, Oceania.
\item {\tt fertility} Total fertility rate, number of children per woman.
\item {\tt ppgdp} Per capita gross domestic product (GDP) in US dollars.
\item {\tt lifeExpF} Female life expectancy, years.
\item {\tt pctUrban} Percent of population in urban areas.
\item {\tt infantMortality} Infant deaths by age 1 year per 1000 live births.
\item {\tt gr} GDP growth rate.
\end{itemize}
\renewcommand{\arraystretch}{3}
```{r echo=FALSE}
data_sum <- UNGrowth %>%
  select(-c(Country)) %>% 
  tbl_summary(by = region,
              statistic = all_continuous() ~ "{mean} ({sd})",
              label = list(
                fertility ~ "Fertility",
                ppgdp ~ "Ppgdp",
                lifeExpF ~ "LifeExpF",
                pctUrban ~ "PctUrban",
                infantMortality ~ "Infant-Mortality",
                gr ~ "Gr")) %>%
  add_overall() %>%
  add_n() %>%
  modify_header(label ~ "**Variable**") %>%
  modify_caption("<div style='text-align: center; font-weight: bold; color: grey'> Table 1. National averages of GDP growth per capita and growth
determinants</div>") %>%
  bold_labels()

as_kable_extra(data_sum, format="latex", booktabs=TRUE, linesep="", digits =3, caption="", align = "lcllll") %>%
  kable_styling(latex_options = "hold_position",
                full_width = TRUE,
                font_size = 9)

```
\section{Exploratory Data Analysis}
```{r boxes1, fig.align="center", out.width="100%", fig.cap="", fig.retina=1, fig.pos="H"}
dis.fert <- ggplot(UNGrowth, aes(x=region, y=fertility, fill=region)) +
  geom_boxplot(alpha=0.5) +
  theme(legend.position="none", 
        panel.grid.minor = element_line(
          colour="lightgrey", linewidth=0.35),
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 0.7, colour = "black", linetype=1)) + 
  scale_y_continuous(minor_breaks = seq(0, 7, 0.5)) +
  labs(x="", y="Fertility")

dis.ppgdp <- ggplot(UNGrowth, aes(x=region, y=ppgdp, fill=region)) +
  geom_boxplot(alpha=0.5) +
  theme(legend.position="none", 
        panel.grid.minor = element_line(
          colour="lightgrey", linewidth=0.35),
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 0.7, colour = "black", linetype=1)) + 
  scale_y_continuous(minor_breaks = seq(0, 110000, 10000)) +
  labs(x="", y="Ppgdp")

dis.lifeExpF <- ggplot(UNGrowth, aes(x=region, y=lifeExpF, fill=region)) +
  geom_boxplot(alpha=0.5) +
  theme(legend.position="none", 
        panel.grid.minor = element_line(
          colour="lightgrey", linewidth=0.35),
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 0.7, colour = "black", linetype=1)) + 
  scale_y_continuous(minor_breaks = seq(40, 90, 5)) +
  labs(x="", y="LifeExpF")

dis.pctUrban <- ggplot(UNGrowth, aes(x=region, y=pctUrban, fill=region)) +
  geom_boxplot(alpha=0.5) +
  theme(legend.position="none", 
        panel.grid.minor = element_line(
          colour="lightgrey", linewidth=0.35),
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 0.7, colour = "black", linetype=1)) + 
  scale_y_continuous(minor_breaks = seq(10, 100, 10)) +
  labs(x="", y="PctUrban")

dis.infantMortality <- ggplot(UNGrowth, aes(x=region, y=infantMortality, fill=region)) +
  geom_boxplot(alpha=0.5) +
  theme(legend.position="none", 
        panel.grid.minor = element_line(
          colour="lightgrey", linewidth=0.35),
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 0.7, colour = "black", linetype=1)) + 
  scale_y_continuous(minor_breaks = seq(0, 130, 10)) +
  labs(x="", y="Infant Mortality")

dis.gr <- ggplot(UNGrowth, aes(x=region, y=gr, fill=region)) +
  geom_boxplot(alpha=0.5) +
  theme(legend.position="none", 
        panel.grid.minor = element_line(
          colour="lightgrey", linewidth=0.35),
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 0.7, colour = "black", linetype=1)) + 
  scale_y_continuous(minor_breaks = seq(-5, 20, 1)) +
  labs(x="", y="Gr")


grid.arrange(dis.fert, dis.ppgdp, 
             dis.lifeExpF, dis.pctUrban, 
             dis.infantMortality, dis.gr, 
             ncol = 2, nrow = 3)
```
\renewcommand{\arraystretch}{1}
```{r recors}
attach(UNGrowth)
cor_gf <- UNGrowth %>%
  group_by(region) %>%
  summarise(Fertility=cor(gr, fertility))

cor_gp <- UNGrowth %>%
  group_by(region) %>%
  summarise(Ppgdp=cor(gr, ppgdp))

cor_gl <- UNGrowth %>%
  group_by(region) %>%
  summarise(LifeExpF=cor(gr, lifeExpF))

cor_gpU <- UNGrowth %>%
  group_by(region) %>%
  summarise(PctUrban=cor(gr, pctUrban))

cor_gi <- UNGrowth %>%
  group_by(region) %>%
  summarise(InfantMortality=cor(gr, infantMortality))

cors <- merge(cor_gf,
              merge(cor_gp,
                    merge(cor_gl,
                          merge(cor_gpU,cor_gi,
                                by="region"),
                          by="region"),
                    by="region"),
              by="region")

kable(cors, format="latex", booktabs=TRUE, linesep="", digits =3, caption="") %>%
  kable_styling(latex_options = c("striped", "hold_position"),
                full_width = FALSE)
detach(UNGrowth)
```

```{r cocors, message=FALSE}
library(plyr)
corby <- function(D)
{
  return(data.frame(FtPg = cor(D$fertility, D$ppgdp), 
                    FtLe = cor(D$fertility, D$lifeExpF), 
                    FtPu = cor(D$fertility, D$pctUrban),
                    FtIm = cor(D$fertility, D$infantMortality),
                    PgLe = cor(D$ppgdp, D$lifeExpF),
                    PgPu = cor(D$ppgdp, D$pctUrban),
                    PgIm = cor(D$ppgdp, D$infantMortality),
                    LePu = cor(D$lifeExpF, D$pctUrban),
                    LeIm = cor(D$lifeExpF, D$infantMortality),
                    PuIm = cor(D$pctUrban, D$infantMortality)))
}
Ccors <- ddply(UNGrowth, .(region), corby)

kable(Ccors, format="latex", booktabs=TRUE, linesep="", 
      digits =3, caption = "")  %>%
  kable_styling(latex_options = c("striped", "hold_position"),
                full_width = TRUE, font_size = 10)
```

```{r boxes2, fig.align="center", out.width="100%", fig.cap="", fig.retina=1, fig.pos="H"}
hi.webs <- ggplot(UNGrowth, aes(x=gr, color=region, fill=region)) + 
  geom_histogram(aes(y=after_stat(density)), bins=30) + 
  theme(panel.background = element_blank()) +
  theme(text=element_text(size=12,  family="montse"),legend.position =c(0.8,0.8), legend.key.size = unit(0.65, 'cm'))+
  labs(x="GDP growth rate", y="Density")

xy.fg <- ggplot(data = UNGrowth, aes(x = fertility, y = gr)) +
  geom_point(aes(color = region), size = 2) +
  theme(text=element_text(size=10,  family="montse"),
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.key.size = unit(0.25, 'cm'),
        legend.margin = margin(4, 4, 4, 4),
        panel.grid.minor = element_line(colour="lightgrey", linewidth=0.5), 
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 1, colour = "black", linetype=1), 
        legend.key = element_rect(fill = "transparent", colour = "transparent"), 
        legend.text = element_text(size = 12), 
        legend.title = element_text(face = "bold", size=12)) +
  labs(x="Fertility", y="GDP growth rate")

xy.pg <- ggplot(data = UNGrowth, aes(x = ppgdp, y = gr)) +
  geom_point(aes(color = region), size = 2) +
  theme(text=element_text(size=10,  family="montse"),
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.key.size = unit(0.25, 'cm'),
        legend.margin = margin(4, 4, 4, 4),
        panel.grid.minor = element_line(colour="lightgrey", linewidth=0.5), 
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 1, colour = "black", linetype=1), 
        legend.key = element_rect(fill = "transparent", colour = "transparent"), 
        legend.text = element_text(size = 12), 
        legend.title = element_text(face = "bold", size=12)) +
  labs(x="Ppgdp", y="GDP growth rate")

xy.lg <- ggplot(data = UNGrowth, aes(x = lifeExpF, y = gr)) +
  geom_point(aes(color = region), size = 2) +
  theme(text=element_text(size=10,  family="montse"),
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.key.size = unit(0.25, 'cm'),
        legend.margin = margin(4, 4, 4, 4),
        panel.grid.minor = element_line(colour="lightgrey", linewidth=0.5), 
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 1, colour = "black", linetype=1), 
        legend.key = element_rect(fill = "transparent", colour = "transparent"), 
        legend.text = element_text(size = 12), 
        legend.title = element_text(face = "bold", size=12)) +
  labs(x="LifeExpF", y="GDP growth rate")

xy.ug <- ggplot(data = UNGrowth, aes(x = pctUrban, y = gr)) +
  geom_point(aes(color = region), size = 2) +
  theme(text=element_text(size=10,  family="montse"),
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.key.size = unit(0.25, 'cm'),
        legend.margin = margin(4, 4, 4, 4),
        panel.grid.minor = element_line(colour="lightgrey", linewidth=0.5), 
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 1, colour = "black", linetype=1), 
        legend.key = element_rect(fill = "transparent", colour = "transparent"), 
        legend.text = element_text(size = 12), 
        legend.title = element_text(face = "bold", size=12)) +
  labs(x="PctUrban", y="GDP growth rate")

xy.ig <- ggplot(data = UNGrowth, aes(x = infantMortality, y = gr)) +
  geom_point(aes(color = region), size = 2) +
  theme(text=element_text(size=10,  family="montse"),
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.key.size = unit(0.25, 'cm'),
        legend.margin = margin(4, 4, 4, 4),
        panel.grid.minor = element_line(colour="lightgrey", linewidth=0.5), 
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 1, colour = "black", linetype=1), 
        legend.key = element_rect(fill = "transparent", colour = "transparent"), 
        legend.text = element_text(size = 12), 
        legend.title = element_text(face = "bold", size=12)) +
  labs(x="InfantMortality", y="GDP growth rate")

grid.arrange(hi.webs, xy.fg, xy.pg, xy.lg, xy.ug, xy.ig, ncol = 2, nrow = 3)

```

```{r boxes3, fig.align="center", out.width="100%", fig.cap="", fig.retina=1, fig.pos="H"}
xy.pg.log <- ggplot(data = UNGrowth, aes(x = log(ppgdp), y = gr)) +
  geom_point(aes(color = region), size = 2) +
  theme(text=element_text(size=10,  family="montse"),
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.key.size = unit(0.25, 'cm'),
        legend.margin = margin(4, 4, 4, 4),
        panel.grid.minor = element_line(colour="lightgrey", linewidth=0.5), 
        panel.background = element_blank(), 
        axis.line = element_line(linewidth = 1, colour = "black", linetype=1), 
        legend.key = element_rect(fill = "transparent", colour = "transparent"), 
        legend.text = element_text(size = 12), 
        legend.title = element_text(face = "bold", size=12)) +
  labs(x="ln(ppgdp)", y="GDP growth rate")

grid.arrange(xy.pg, xy.pg.log, ncol = 2, nrow=3)
```

\section{Modelling}
\section{Results}
\section{Conclusions}
\section{Discussion}
\section{References}

